# `fetch` amb `async/await`

La interfície async/await en JavaScript és una manera moderna i elegant de gestionar operacions asíncrones, fent que el **codi sigui més llegible, estructurat i mantenible** en comparació amb les promeses (evita l'encadenament de `.then`) i les famoses "callback hell". Va ser introduïda amb ECMAScript 2017 (ES8) i ha esdevingut la forma preferida per treballar amb codi asíncron.

Per fer ús d'aquesta interfície només hem de:

* Fer ús d'`await` quan volem *esperar* el resultat d'una operació asíncrona
* Marcar la funció que utilitza l'`await` com a asíncrona amb `async`.

```js
async function consultaAPI() {
    try {
        const resposta = await fetch('https://jsonplaceholder.typicode.com/todos/1');
        const dades = await resposta.json(); // Convertim la resposta en JSON
        console.log(dades);
    } catch (error) {
        console.error("S'ha produït un error:", error);
    }
}

consultaAPI();
```

## Com funciona això?

* La paraula clau `async` fa que la funció retorne una *promesa*, i ens permet fer ús d'`await` a dins seu.
* Amb `await`, la funció queda *pausada* fins que es resol la promesa, sense bloquejar el fil principal.

Internament, quan el motor de Javascript troba `await`, fa el següent:

1. Marca la funció asíncrona com *pausada*
2. Delega la tasca a l'API Web del navegador
3. Retorna immediatament el control al fil principal, perquè aquest puga seguir executant codi
4. Quan la promesa es resol, el resultat passa a la cúa de *microtasques* (si es tracta d'una promesa) o a la cúa d'events (per a temporitzadors i eltres events)
5️. L'**Event Loop** revisa les cúes i executa les funcions que hi resten, després del codi principal.

!!!note "Conclussió"
    Com veiem, l'ús d'`await` no aporta res en sí al llenguatge, sinò que es tracta de *sucre sintàctic*, ja que internament segueix funcionant amb promeses.


## Exercici

Crea una funció nova que realitze la petició GET per obtenir les pizzes a l'URL fent ús d'`Async/Await`, i que pugues reemplaçar per l'anterior. 

Quan ho faces, deixa comentat el codi que teníes, per tal de poder alternar entre una petició i altra.

