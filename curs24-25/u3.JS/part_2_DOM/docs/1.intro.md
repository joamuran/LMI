# Introducció. JavaScript en entorns client.

Quan parlem de programació web, hem de tindre en compte que aquesta és la suma de tres elements principals:

>
> Pàgina web = Estructura (HTML) + Presentació (CSS) + Comportament (JavaScript)                                
>

Per tal d'incorporar codi JavaScript a un document HTML, podem fer-ho de diverses maneres:

1. **Associant codi directament a un esdeveniment lligat a un objecte HTML** (mètode poc recomanable i desaconsellat per les bones pràctiques actuals, ja que mescla estructura i comportament):

    ```html
    <body onload="alert('Bon dia')">
    ```

2. **Fent ús de l'etiqueta `<script>` dins el mateix codi HTML** (recomanat només per a exemples senzills):

    ```html
    <body>
        ...
        <script>
        alert('Hola món!');
        </script>
    </body>
    ```

3. **Fent ús de l'etiqueta `<script>` amb l'atribut `src` per incloure el JavaScript en un fitxer extern** (pràctica recomanada, ja que separa estructura i comportament):

    ```html
    <body>
        ...
        <script src="js/fitxerJS.js"></script>
    </body>
    ```

!!! note "Sobre la ubicacó de l'etiqueta `<script>`"
     Per assegurar que el DOM està carregat abans d'executar el codi, és recomanable col·locar l'etiqueta `<script>` com una de les últimes al document, just abans del tancament de l'etiqueta `</body>`. Alternativament, es pot utilitzar l'atribut `defer` per carregar els scripts en segon pla i executar-los només quan el document estiga completament carregat:

     ```html
     <script src="js/fitxerJS.js" defer></script>
     ```

Quan el navegador web rep un document HTML, el converteix en una estructura que es pot *renderitzar* o *dibuixar* a la finestra del navegador. Aquesta estructura jeràrquica es coneix com el **DOM** (Document Object Model). Quan un document HTML porta associat codi JavaScript, aquest s'ha d'executar ina vegada el *DOM* està completament construït.

**Punt d'entrada al JavaScript**

El punt d'entrada recomanat per executar codi JavaScript és l'event `DOMContentLoaded`, que s'activa quan el navegador ha carregat i processat completament l'estructura HTML, sense esperar que es carreguen recursos externs com imatges o fulls d'estil.

```js
document.addEventListener('DOMContentLoaded', function() {
    // Codi JavaScript
});
```

Parem-nos a mirar atentament el codi anterior:

* **`document`** serà l'objecte que **representarà el DOM** del document web actual.
* **`addEventListener`** és un mètode (funció) del DOM, que ens permet *afegir un escoltador d'esdeveniments* al DOM. És a dir, associar determinada funcionalitat a quan ocorre determinat esdeveniment en el DOM. Els dos arguments que té s'encarreguen d'això: 
    * **Primer argument**: És el nom de l'event que es produeix, en aquest cas, l'event `DOMContentLoaded`, que es dispara quan es carrega el DOM (sense recursos).
    * **Segon argument**: És una funció anònima (lambda) que s'executarà quan es produeix l'event. 

Un altre mecanisme semblant que podem trobar en algunes pàgines o bibliografia és gestionar l'event `window.onload`, de la següent manera:

```js
window.onload = function() {
    // Codi JavaScript
};
```

On l'objecte `window` representa la finestra del navegador. Amb `window.onload=function(){...}` el que fem és associar una funció anònima a l'event *onload*, que es produeix quan es carrega completament de la pàgina, incloent els recursos.

!!! note "`DOMContentLoaded` o `onload`?"
     El mes recomanable i preferible és utilitzar l'esdeveniment `DOMContentLoaded`, ja que generalment no necessitem esperar a que estiguen carregats tots els recursos associats al document per executar el codi Javascript.

     Si, per alguna raó, cal assegurar-se que absolutament tots els recursos estan carregats abans d'executar el codi, es pot utilitzar `window.onload`.


!!! note "Funcions anònimes i funcions amb nom"
     En els exemples anteriors, hem utilitzat una *funció anònima*, és a dir, una funció sense nom. Aquest tipus de funcions són útils quan només s'utilitzen una vegada, com per associar accions a esdeveniments.

     També podem utilitzar una funció amb nom si volem reutilitzar-la o per una major claredat del codi:


     ```js
     function iniciarApp() {
         // Codi JavaScript
     }

     // Associem la funció a l'event DOMContentLoaded
     document.addEventListener('DOMContentLoaded', iniciarApp);
     ```